<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Climb Power Calculator</title>
  <style>
    /* Reset & base */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      max-width: 720px;
      margin: 1rem auto;
      padding: 1rem;
      background: #f8fafc;
      color: #222;
      line-height: 1.5;
    }

    h1, h2 {
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1f2937;
      text-align: center;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.07);
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
    }

    .grid {
      display: grid;
      gap: 1rem 1.5rem;
    }

    /* 2 columns on desktop, 1 column on mobile */
    @media (min-width: 480px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    label {
      display: flex;
      flex-direction: column;
      font-weight: 500;
      font-size: 0.9rem;
      color: #374151;
    }

    input[type="number"],
    select {
      margin-top: 0.4rem;
      padding: 0.6rem 0.75rem;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgb(59 130 246 / 0.3);
    }

    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      display: block;
      width: 100%;
      max-width: 280px;
      margin: 0 auto;
      box-shadow: 0 6px 15px rgb(37 99 235 / 0.4);
      transition: background-color 0.25s ease;
    }

    button:hover {
      background: #1d4ed8;
    }

    .result {
      background: #e0e7ff;
      border-radius: 10px;
      padding: 1.5rem 2rem;
      font-size: 1.05rem;
      font-weight: 600;
      color: #1e40af;
      text-align: center;
      user-select: none;
      box-shadow: 0 6px 12px rgb(59 130 246 / 0.2);
    }

    canvas {
      margin-top: 2rem;
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 18px rgb(0 0 0 / 0.1);
    }
  </style>
</head>
<body>
  <h1>Climb Power Calculator</h1>

  <section class="card" aria-label="Climb Inputs">
    <div class="grid">
      <label for="elev">Elevation Gain (m)
        <input type="number" id="elev" value="919" min="0" />
      </label>
      <label for="dist">Distance (km)
        <input type="number" id="dist" value="12.2" min="0" step="0.1" />
      </label>
      <label for="min">Time - Minutes
        <input type="number" id="min" value="33" min="0" />
      </label>
      <label for="sec">Time - Seconds
        <input type="number" id="sec" value="32" min="0" max="59" />
      </label>
      <label for="body">Body Weight (kg)
        <input type="number" id="body" value="62" min="1" step="0.1" />
      </label>
      <label for="gear">Bike + Gear Weight (kg)
        <input type="number" id="gear" value="8" min="0" step="0.1" />
      </label>
    </div>
  </section>

  <section class="card" aria-label="Coefficient Presets and Custom Inputs">
    <label for="preset">Preset
      <select id="preset" onchange="setPreset()">
        <option value="default">Default (road bike)</option>
        <option value="aero">Aero setup (TT bike)</option>
        <option value="mtb">MTB or gravel</option>
        <option value="tdf">Tour de France (climbing pro)</option>
        <option value="custom">Custom</option>
      </select>
    </label>

    <div class="grid" style="margin-top:1rem;">
      <label for="cda">Drag Coefficient × Area (CdA)
        <input type="number" id="cda" value="0.35" step="0.01" min="0" />
      </label>
      <label for="crr">Rolling Resistance Coefficient (Crr)
        <input type="number" id="crr" value="0.004" step="0.001" min="0" />
      </label>
      <label for="eta">Mechanical Efficiency (0–1)
        <input type="number" id="eta" value="0.97" step="0.01" min="0" max="1" />
      </label>
    </div>
  </section>

  <button onclick="calculate()" aria-label="Calculate power output and watts per kg">Calculate</button>

  <div class="result" id="output" role="region" aria-live="polite" aria-atomic="true"></div>

  <canvas id="barChart" height="100" aria-label="Power breakdown chart"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let chart;

    function setPreset() {
      const preset = document.getElementById("preset").value;
      const cda = document.getElementById("cda");
      const crr = document.getElementById("crr");
      const eta = document.getElementById("eta");

      if (preset === "default") {
        cda.value = 0.35;
        crr.value = 0.004;
        eta.value = 0.97;
      } else if (preset === "aero") {
        cda.value = 0.25;
        crr.value = 0.003;
        eta.value = 0.98;
      } else if (preset === "mtb") {
        cda.value = 0.45;
        crr.value = 0.008;
        eta.value = 0.96;
      } else if (preset === "tdf") {
        cda.value = 0.30;
        crr.value = 0.004;
        eta.value = 0.98;
      } else if (preset === "custom") {
        // don't overwrite custom inputs
      }
    }

    function calculate() {
      const g = 9.81;
      const rho = 1.2;

      const elev = +document.getElementById("elev").value;
      const dist = +document.getElementById("dist").value * 1000;
      const time = +document.getElementById("min").value * 60 + +document.getElementById("sec").value;
      const body = +document.getElementById("body").value;
      const gear = +document.getElementById("gear").value;
      const cda = +document.getElementById("cda").value;
      const crr = +document.getElementById("crr").value;
      const eta = +document.getElementById("eta").value;

      const mass = body + gear;
      const speed = dist / time;

      const P_gravity = (mass * g * elev) / time;
      const P_rolling = (mass * g * crr * dist) / time;
      const P_aero = 0.5 * rho * cda * speed ** 3;

      const P_mech_input = P_gravity + P_rolling + P_aero;
      const P_total = P_mech_input / eta;
      const W_per_kg = P_total / body;

      const output = document.getElementById("output");
      output.textContent = `Estimated Power: ${Math.round(P_total)} W (${W_per_kg.toFixed(2)} W/kg)`;
    
      const ctx = document.getElementById("barChart").getContext("2d");
    
      if (chart) {
        chart.destroy();
      }

  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Gravity", "Rolling", "Aerodynamic"],
      datasets: [{
        label: "Watts",
        data: [P_gravity, P_rolling, P_aero],
        backgroundColor: ["#3b82f6", "#facc15", "#10b981"],
        borderRadius: 8,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.dataset.label}: ${context.raw.toFixed(1)} W`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Power (W)',
            font: { weight: 'bold' }
          }
        }
      }
    }
  });
}

calculate(); // Initial calculation

